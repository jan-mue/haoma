<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Haoma Tensorflow.js Test</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@1.0.0/dist/tf.min.js"></script>
</head>
<body>

 <form name="myForm" action="/action_page.php" method="post">
     Priority: <input type="text" name="priority"><br>
     Condition: <input type="text" name="condition"><br>
     Age: <input type="text" name="age"><br>
     Insurance: <input type="text" name="insurance"><br>
     <input type="submit" value="Submit">
</form>

<script>
    function flatten(arr) {
        return arr.reduce(function (flat, toFlatten) {
            return flat.concat(Array.isArray(toFlatten) ? flatten(toFlatten) : toFlatten);
        }, []);
    }

    $('form').on('keyup change paste', 'input, select, textarea', function(){
        var values = {};
        $.each($('form').serializeArray(), function(i, field) {
            values[field.name] = field.value;
        });
        console.log(values);

        const condition_lut = {
            'unknown': [0.0, 0.0, 0.0],
            'walk': [0.0, 0.0, 1.0],
            'wheelchair': [0.0, 1.0, 0.0],
            'bed': [1.0, 0.0, 0.0],
        };

        const insurance_lut = {
            'public': 0.9,
            'private': 0.1,
        };


        var priority = parseFloat(values['priority']) / 10.0;
        var condition = condition_lut[values['condition']];
        var age = parseFloat(values['age']) / 100.0;
        var insurance = insurance_lut[values['insurance']];

        var prediction_input = [flatten([priority, condition, age, insurance])];
        console.log(prediction_input);

        const model = tf.loadLayersModel('procedure_model/model.json');
        const prediction = model.predict(tf.tensor([[priority_code, pat_condition, pat_age, pat_insurance]]));

        console.log(prediction);
    });
</script>

</body>
</html>